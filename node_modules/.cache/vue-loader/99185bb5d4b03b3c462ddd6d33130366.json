{"remainingRequest":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/src/views/Message/index.vue?vue&type=style&index=0&id=5d122bca&scoped=true&lang=css&","dependencies":[{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/src/views/Message/index.vue","mtime":1622901908822},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubWVzc2FnZS1jb250YWluZXIgewogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMTAwJTsKICBvdmVyZmxvdy15OiBhdXRvOwogIHBhZGRpbmc6IDI1cHggMDsKICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogIHNjcm9sbC1iZWhhdmlvcjogc21vb3RoOwp9Ci5tZXNzYWdlLWFyZWEtY29udGFpbmVyIHsKICB3aWR0aDogNzAwcHg7CiAgbWFyZ2luOiAwIGF1dG87Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Message","sourcesContent":["<template>\n  <div class=\"message-container\" ref=\"messageContainer\">\n    <MessageArea\n      title=\"留言板\"\n      :subTitle=\"`(${data.total})`\"\n      :isListLoading=\"isLoading\"\n      :list=\"data.rows\"\n      @submit=\"handleSubmit\"\n    />\n  </div>\n</template>\n\n<script>\nimport MessageArea from \"@/components/MessageArea\";\nimport fetchData from \"@/mixins/fetchData.js\";\nimport * as msgApi from \"@/api/message.js\";\nimport mainScroll from \"@/mixins/mainScroll.js\";\nexport default {\n  components: {\n    MessageArea,\n  },\n  data() {\n    return {\n      page: 1,\n      limit: 10,\n    };\n  },\n  mixins: [fetchData({ total: 0, rows: [] }), mainScroll(\"messageContainer\")],\n  created() {\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n  destroyed() {\n    this.$bus.$off(\"mainScroll\", this.handleScroll);\n  },\n  computed: {\n    hasMore() {\n      return this.data.rows.length < this.data.total;\n    },\n  },\n  methods: {\n    async fetchData() {\n      return msgApi.getMessages(this.page, this.limit);\n    },\n    handleScroll(dom) {\n      if (this.isLoading || !dom) {\n        // 目前正在加载更多\n        return;\n      }\n      const range = 100; // 顶一个可接受的范围，在这个范围内都算达到了底部\n      const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n      if (dec <= range) {\n        this.fetchMore();\n      }\n    },\n    // 加载下一页\n    async fetchMore() {\n      if (!this.hasMore) {\n        // 没有更多啦\n        return;\n      }\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n    async handleSubmit(data, callback) {\n      const resp = await msgApi.postMessage(data);\n      callback(\"感谢您的留言\");\n      this.data.rows.unshift(resp);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.message-container {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px 0;\n  box-sizing: border-box;\n  scroll-behavior: smooth;\n}\n.message-area-container {\n  width: 700px;\n  margin: 0 auto;\n}\n</style>\n"]}]}