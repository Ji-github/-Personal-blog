{"remainingRequest":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/src/views/Message/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/src/views/Message/index.vue","mtime":1622901908822},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBNZXNzYWdlQXJlYSBmcm9tICJAL2NvbXBvbmVudHMvTWVzc2FnZUFyZWEiOwppbXBvcnQgZmV0Y2hEYXRhIGZyb20gIkAvbWl4aW5zL2ZldGNoRGF0YS5qcyI7CmltcG9ydCAqIGFzIG1zZ0FwaSBmcm9tICJAL2FwaS9tZXNzYWdlLmpzIjsKaW1wb3J0IG1haW5TY3JvbGwgZnJvbSAiQC9taXhpbnMvbWFpblNjcm9sbC5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBNZXNzYWdlQXJlYSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwYWdlOiAxLAogICAgICBsaW1pdDogMTAsCiAgICB9OwogIH0sCiAgbWl4aW5zOiBbZmV0Y2hEYXRhKHsgdG90YWw6IDAsIHJvd3M6IFtdIH0pLCBtYWluU2Nyb2xsKCJtZXNzYWdlQ29udGFpbmVyIildLAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLiRidXMuJG9uKCJtYWluU2Nyb2xsIiwgdGhpcy5oYW5kbGVTY3JvbGwpOwogIH0sCiAgZGVzdHJveWVkKCkgewogICAgdGhpcy4kYnVzLiRvZmYoIm1haW5TY3JvbGwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7CiAgfSwKICBjb21wdXRlZDogewogICAgaGFzTW9yZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGF0YS5yb3dzLmxlbmd0aCA8IHRoaXMuZGF0YS50b3RhbDsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBmZXRjaERhdGEoKSB7CiAgICAgIHJldHVybiBtc2dBcGkuZ2V0TWVzc2FnZXModGhpcy5wYWdlLCB0aGlzLmxpbWl0KTsKICAgIH0sCiAgICBoYW5kbGVTY3JvbGwoZG9tKSB7CiAgICAgIGlmICh0aGlzLmlzTG9hZGluZyB8fCAhZG9tKSB7CiAgICAgICAgLy8g55uu5YmN5q2j5Zyo5Yqg6L295pu05aSaCiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHJhbmdlID0gMTAwOyAvLyDpobbkuIDkuKrlj6/mjqXlj5fnmoTojIPlm7TvvIzlnKjov5nkuKrojIPlm7TlhoXpg73nrpfovr7liLDkuoblupXpg6gKICAgICAgY29uc3QgZGVjID0gTWF0aC5hYnMoZG9tLnNjcm9sbFRvcCArIGRvbS5jbGllbnRIZWlnaHQgLSBkb20uc2Nyb2xsSGVpZ2h0KTsKICAgICAgaWYgKGRlYyA8PSByYW5nZSkgewogICAgICAgIHRoaXMuZmV0Y2hNb3JlKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDliqDovb3kuIvkuIDpobUKICAgIGFzeW5jIGZldGNoTW9yZSgpIHsKICAgICAgaWYgKCF0aGlzLmhhc01vcmUpIHsKICAgICAgICAvLyDmsqHmnInmm7TlpJrllaYKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBhZ2UrKzsKICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuZmV0Y2hEYXRhKCk7CiAgICAgIHRoaXMuZGF0YS50b3RhbCA9IHJlc3AudG90YWw7CiAgICAgIHRoaXMuZGF0YS5yb3dzID0gdGhpcy5kYXRhLnJvd3MuY29uY2F0KHJlc3Aucm93cyk7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICB9LAogICAgYXN5bmMgaGFuZGxlU3VibWl0KGRhdGEsIGNhbGxiYWNrKSB7CiAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBtc2dBcGkucG9zdE1lc3NhZ2UoZGF0YSk7CiAgICAgIGNhbGxiYWNrKCLmhJ/osKLmgqjnmoTnlZnoqIAiKTsKICAgICAgdGhpcy5kYXRhLnJvd3MudW5zaGlmdChyZXNwKTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Message","sourcesContent":["<template>\n  <div class=\"message-container\" ref=\"messageContainer\">\n    <MessageArea\n      title=\"留言板\"\n      :subTitle=\"`(${data.total})`\"\n      :isListLoading=\"isLoading\"\n      :list=\"data.rows\"\n      @submit=\"handleSubmit\"\n    />\n  </div>\n</template>\n\n<script>\nimport MessageArea from \"@/components/MessageArea\";\nimport fetchData from \"@/mixins/fetchData.js\";\nimport * as msgApi from \"@/api/message.js\";\nimport mainScroll from \"@/mixins/mainScroll.js\";\nexport default {\n  components: {\n    MessageArea,\n  },\n  data() {\n    return {\n      page: 1,\n      limit: 10,\n    };\n  },\n  mixins: [fetchData({ total: 0, rows: [] }), mainScroll(\"messageContainer\")],\n  created() {\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n  destroyed() {\n    this.$bus.$off(\"mainScroll\", this.handleScroll);\n  },\n  computed: {\n    hasMore() {\n      return this.data.rows.length < this.data.total;\n    },\n  },\n  methods: {\n    async fetchData() {\n      return msgApi.getMessages(this.page, this.limit);\n    },\n    handleScroll(dom) {\n      if (this.isLoading || !dom) {\n        // 目前正在加载更多\n        return;\n      }\n      const range = 100; // 顶一个可接受的范围，在这个范围内都算达到了底部\n      const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n      if (dec <= range) {\n        this.fetchMore();\n      }\n    },\n    // 加载下一页\n    async fetchMore() {\n      if (!this.hasMore) {\n        // 没有更多啦\n        return;\n      }\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n    async handleSubmit(data, callback) {\n      const resp = await msgApi.postMessage(data);\n      callback(\"感谢您的留言\");\n      this.data.rows.unshift(resp);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.message-container {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px 0;\n  box-sizing: border-box;\n  scroll-behavior: smooth;\n}\n.message-area-container {\n  width: 700px;\n  margin: 0 auto;\n}\n</style>\n"]}]}