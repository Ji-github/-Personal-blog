{"remainingRequest":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/thread-loader/dist/cjs.js!/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/babel-loader/lib/index.js!/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/src/views/Message/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/src/views/Message/index.vue","mtime":1622901908822},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jixinyan/Desktop/前端/DuYi-Vue2/1. 入门/39. 打包结果分析/课堂代码/my-site/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IE1lc3NhZ2VBcmVhIGZyb20gIkAvY29tcG9uZW50cy9NZXNzYWdlQXJlYSI7CmltcG9ydCBmZXRjaERhdGEgZnJvbSAiQC9taXhpbnMvZmV0Y2hEYXRhLmpzIjsKaW1wb3J0ICogYXMgbXNnQXBpIGZyb20gIkAvYXBpL21lc3NhZ2UuanMiOwppbXBvcnQgbWFpblNjcm9sbCBmcm9tICJAL21peGlucy9tYWluU2Nyb2xsLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIE1lc3NhZ2VBcmVhCiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBhZ2U6IDEsCiAgICAgIGxpbWl0OiAxMAogICAgfTsKICB9LAoKICBtaXhpbnM6IFtmZXRjaERhdGEoewogICAgdG90YWw6IDAsCiAgICByb3dzOiBbXQogIH0pLCBtYWluU2Nyb2xsKCJtZXNzYWdlQ29udGFpbmVyIildLAoKICBjcmVhdGVkKCkgewogICAgdGhpcy4kYnVzLiRvbigibWFpblNjcm9sbCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTsKICB9LAoKICBkZXN0cm95ZWQoKSB7CiAgICB0aGlzLiRidXMuJG9mZigibWFpblNjcm9sbCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTsKICB9LAoKICBjb21wdXRlZDogewogICAgaGFzTW9yZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGF0YS5yb3dzLmxlbmd0aCA8IHRoaXMuZGF0YS50b3RhbDsKICAgIH0KCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBmZXRjaERhdGEoKSB7CiAgICAgIHJldHVybiBtc2dBcGkuZ2V0TWVzc2FnZXModGhpcy5wYWdlLCB0aGlzLmxpbWl0KTsKICAgIH0sCgogICAgaGFuZGxlU2Nyb2xsKGRvbSkgewogICAgICBpZiAodGhpcy5pc0xvYWRpbmcgfHwgIWRvbSkgewogICAgICAgIC8vIOebruWJjeato+WcqOWKoOi9veabtOWkmgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcmFuZ2UgPSAxMDA7IC8vIOmhtuS4gOS4quWPr+aOpeWPl+eahOiMg+WbtO+8jOWcqOi/meS4quiMg+WbtOWGhemDveeul+i+vuWIsOS6huW6lemDqAoKICAgICAgY29uc3QgZGVjID0gTWF0aC5hYnMoZG9tLnNjcm9sbFRvcCArIGRvbS5jbGllbnRIZWlnaHQgLSBkb20uc2Nyb2xsSGVpZ2h0KTsKCiAgICAgIGlmIChkZWMgPD0gcmFuZ2UpIHsKICAgICAgICB0aGlzLmZldGNoTW9yZSgpOwogICAgICB9CiAgICB9LAoKICAgIC8vIOWKoOi9veS4i+S4gOmhtQogICAgYXN5bmMgZmV0Y2hNb3JlKCkgewogICAgICBpZiAoIXRoaXMuaGFzTW9yZSkgewogICAgICAgIC8vIOayoeacieabtOWkmuWVpgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBhZ2UrKzsKICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuZmV0Y2hEYXRhKCk7CiAgICAgIHRoaXMuZGF0YS50b3RhbCA9IHJlc3AudG90YWw7CiAgICAgIHRoaXMuZGF0YS5yb3dzID0gdGhpcy5kYXRhLnJvd3MuY29uY2F0KHJlc3Aucm93cyk7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICB9LAoKICAgIGFzeW5jIGhhbmRsZVN1Ym1pdChkYXRhLCBjYWxsYmFjaykgewogICAgICBjb25zdCByZXNwID0gYXdhaXQgbXNnQXBpLnBvc3RNZXNzYWdlKGRhdGEpOwogICAgICBjYWxsYmFjaygi5oSf6LCi5oKo55qE55WZ6KiAIik7CiAgICAgIHRoaXMuZGF0YS5yb3dzLnVuc2hpZnQocmVzcCk7CiAgICB9CgogIH0KfTs="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;AAaA,OAAA,WAAA,MAAA,0BAAA;AACA,OAAA,SAAA,MAAA,uBAAA;AACA,OAAA,KAAA,MAAA,MAAA,kBAAA;AACA,OAAA,UAAA,MAAA,wBAAA;AACA,eAAA;AACA,EAAA,UAAA,EAAA;AACA,IAAA;AADA,GADA;;AAIA,EAAA,IAAA,GAAA;AACA,WAAA;AACA,MAAA,IAAA,EAAA,CADA;AAEA,MAAA,KAAA,EAAA;AAFA,KAAA;AAIA,GATA;;AAUA,EAAA,MAAA,EAAA,CAAA,SAAA,CAAA;AAAA,IAAA,KAAA,EAAA,CAAA;AAAA,IAAA,IAAA,EAAA;AAAA,GAAA,CAAA,EAAA,UAAA,CAAA,kBAAA,CAAA,CAVA;;AAWA,EAAA,OAAA,GAAA;AACA,SAAA,IAAA,CAAA,GAAA,CAAA,YAAA,EAAA,KAAA,YAAA;AACA,GAbA;;AAcA,EAAA,SAAA,GAAA;AACA,SAAA,IAAA,CAAA,IAAA,CAAA,YAAA,EAAA,KAAA,YAAA;AACA,GAhBA;;AAiBA,EAAA,QAAA,EAAA;AACA,IAAA,OAAA,GAAA;AACA,aAAA,KAAA,IAAA,CAAA,IAAA,CAAA,MAAA,GAAA,KAAA,IAAA,CAAA,KAAA;AACA;;AAHA,GAjBA;AAsBA,EAAA,OAAA,EAAA;AACA,UAAA,SAAA,GAAA;AACA,aAAA,MAAA,CAAA,WAAA,CAAA,KAAA,IAAA,EAAA,KAAA,KAAA,CAAA;AACA,KAHA;;AAIA,IAAA,YAAA,CAAA,GAAA,EAAA;AACA,UAAA,KAAA,SAAA,IAAA,CAAA,GAAA,EAAA;AACA;AACA;AACA;;AACA,YAAA,KAAA,GAAA,GAAA,CALA,CAKA;;AACA,YAAA,GAAA,GAAA,IAAA,CAAA,GAAA,CAAA,GAAA,CAAA,SAAA,GAAA,GAAA,CAAA,YAAA,GAAA,GAAA,CAAA,YAAA,CAAA;;AACA,UAAA,GAAA,IAAA,KAAA,EAAA;AACA,aAAA,SAAA;AACA;AACA,KAdA;;AAeA;AACA,UAAA,SAAA,GAAA;AACA,UAAA,CAAA,KAAA,OAAA,EAAA;AACA;AACA;AACA;;AACA,WAAA,SAAA,GAAA,IAAA;AACA,WAAA,IAAA;AACA,YAAA,IAAA,GAAA,MAAA,KAAA,SAAA,EAAA;AACA,WAAA,IAAA,CAAA,KAAA,GAAA,IAAA,CAAA,KAAA;AACA,WAAA,IAAA,CAAA,IAAA,GAAA,KAAA,IAAA,CAAA,IAAA,CAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AACA,WAAA,SAAA,GAAA,KAAA;AACA,KA3BA;;AA4BA,UAAA,YAAA,CAAA,IAAA,EAAA,QAAA,EAAA;AACA,YAAA,IAAA,GAAA,MAAA,MAAA,CAAA,WAAA,CAAA,IAAA,CAAA;AACA,MAAA,QAAA,CAAA,QAAA,CAAA;AACA,WAAA,IAAA,CAAA,IAAA,CAAA,OAAA,CAAA,IAAA;AACA;;AAhCA;AAtBA,CAAA","sourcesContent":["<template>\n  <div class=\"message-container\" ref=\"messageContainer\">\n    <MessageArea\n      title=\"留言板\"\n      :subTitle=\"`(${data.total})`\"\n      :isListLoading=\"isLoading\"\n      :list=\"data.rows\"\n      @submit=\"handleSubmit\"\n    />\n  </div>\n</template>\n\n<script>\nimport MessageArea from \"@/components/MessageArea\";\nimport fetchData from \"@/mixins/fetchData.js\";\nimport * as msgApi from \"@/api/message.js\";\nimport mainScroll from \"@/mixins/mainScroll.js\";\nexport default {\n  components: {\n    MessageArea,\n  },\n  data() {\n    return {\n      page: 1,\n      limit: 10,\n    };\n  },\n  mixins: [fetchData({ total: 0, rows: [] }), mainScroll(\"messageContainer\")],\n  created() {\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n  destroyed() {\n    this.$bus.$off(\"mainScroll\", this.handleScroll);\n  },\n  computed: {\n    hasMore() {\n      return this.data.rows.length < this.data.total;\n    },\n  },\n  methods: {\n    async fetchData() {\n      return msgApi.getMessages(this.page, this.limit);\n    },\n    handleScroll(dom) {\n      if (this.isLoading || !dom) {\n        // 目前正在加载更多\n        return;\n      }\n      const range = 100; // 顶一个可接受的范围，在这个范围内都算达到了底部\n      const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n      if (dec <= range) {\n        this.fetchMore();\n      }\n    },\n    // 加载下一页\n    async fetchMore() {\n      if (!this.hasMore) {\n        // 没有更多啦\n        return;\n      }\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n    async handleSubmit(data, callback) {\n      const resp = await msgApi.postMessage(data);\n      callback(\"感谢您的留言\");\n      this.data.rows.unshift(resp);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.message-container {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px 0;\n  box-sizing: border-box;\n  scroll-behavior: smooth;\n}\n.message-area-container {\n  width: 700px;\n  margin: 0 auto;\n}\n</style>\n"],"sourceRoot":"src/views/Message"}]}